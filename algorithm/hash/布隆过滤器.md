# 布隆过滤器（BloomFiler）

先给定一个场景：如何在判断某个URL是否在若干URL中？如果已经URL总数不多（例如几百个），可以直接使用HashMap或者HashSet，但是在几亿个URL中判断某个URL是否存在就不太合适了，因为当URL集合中的元素过多时空间利用率太低，甚至可能会爆内存。

布隆过滤器是一种数据结构，比较巧妙的概率型数据结构，特点是高效地插入和查询。

##  数据结构

布隆过滤器是一个 bit 向量或者说 bit 数组：

![img](http://oss.lanjingdejia.com/file/2018/7/d2fb6f30cbe3430db4eeb6bb7752c0be-image.png)

布隆过滤器可以通过一系列的映射函数（hash函数）将某个元素映射到这个bit向量中。例如，在上图中，一个URL通过5个不同的hash函数（上图标注的有问题）映射到了bit向量上的5个点。不同的URL可以使不同位置上的值置位。判断一个URL是否已经存在时，一次看5个bit位是否为1就可以了，如果有任何一个不为1，那么说明这个URL不存在。

## 判断的准确性

这里需要注意的是，如果对应的bit位值都为1，那么也不能肯定这个url一定存在。这是布隆过滤器的存在问题：具有一定误判的概率。使用布隆过滤器判断是否存在，其本质和使用单个hash函数计算得到的hash值判断是类似的。对于后者，我们使用计算得到的hash值替代原值进行判断，这种操作相当于将大量数据的相等判断转换为了取值范围更小的hash值得判断；显而易见的是，hash值相等并不代表两个元素相等（存在hash碰撞的情况），但是hash值不相等则连个元素必然不等。

布隆过滤器为了减少hash碰撞带来的影响，使用了多个hash函数进行映射，但是仍然无法避免这种情况的出现。因为，布隆过滤器使用的是，只要某个元素将bit向量上的某个值置位了，那么向量上这个标志位就是1。因此，随着增加的元素越来越多，被置为 1 的 bit 位也会越来越多，出现碰撞的可能性就越大。

## 不支持删除

由于布隆过滤器采用的这种置位的方式不能区别某个bit位是哪个元素置位的，因此就不能高效的支持删除操作。

## 应用场景 

1 黑名单；2 URL去重；3 单次拼写检查；4 Key-Value缓存系统的Key校验；5 ID校验



<br>

---

**参考资料**

1. [那些惊艳的算法们（一）——布隆过滤器](https://blog.csdn.net/xinzhongtianxia/article/details/81294922)
2. [详解布隆过滤器的原理、使用场景和注意事项](https://www.jianshu.com/p/2104d11ee0a2)