# 进程与线程的区别

本文主要探讨：进程与线程的本质区别、以及各自的使用场景

#### 进程

**进程**：操作系统对一个正在运行的程序的抽象

**上下文切换**：无论实在单核还是多核系统中，一个CPU看上去都像是在并发的执行多个进程，这是通过**处理器在进程间切换**来实现的，操作系统实现这种交错执行的机制称为上下文切换。

操作系统保持跟踪进程运行所需的所有状态信息。这种状态，也就是**上下文**，包括许多信息，比如PC和寄存器文件的当前值，以及主存的内容。

在任何一个时刻，单处理器系统都只能执行一个进程的代码。但是系统的单个核可以通过上下文切换交错执行多个进程的指令，形成一种同时运行的表象。

从一个进程到另一个进程的转换是由操作系统**内核**（kernel）管理的，内核是操作系统代码常驻主存的部分。注意，**内核不是一个独立的进程**。相反，它是**系统管理全部进程所用代码和数据结构的集合**。

#### 线程

在现代系统中，一个进程实际上可以由多个称为**线程**的执行单元组成，每个线程都运行在进程的上下文中，并享有同样的代码和全局数据。

多个进程可能来自于不同的用户，但单个进程总是来自同一个用户，单个进程的中的多线程是用来彼此合作的，因此各个线程可以访问进程地址空间中的每一个内存地址，所以说一个线程可以读、写或者甚至是清除另一个线程的堆栈。线程之间是没有保护的，因此编写多线程程序需要格外小心。

<br>

至于有了进程后为什么需要线程：

第一，传统操作系统中，每个进程有一个地址空间和控制线程。有了多线程的概念后，并行的实体拥有共享同一个地址空间和所有可用数据的能力。这一点正是多进程模型（他们具有不同的地址空间）无法表达的。

第二，线程比进程更加轻量级，线程更容易创建（更快），也更容易撤销。在许多系统中，创建一个线程的时间比创建一个进程的时间快10~100倍。

第三，主要是部分场景下的性能区别。若多个线程都是CPU密集型的，创建更多的线程并不能获得性能上的增强，但是如果存在大量的计算和大量的IO处理，那么拥有多个线程允许这些活动彼此重叠进行，从而加快执行速度。

第四，在多CPU系统中，多线程是有益的。





<br>

---

**参考资料**

1. 《深入理解计算机系统（原书第3版）》Randal E. Bryant，David O' Hallaron， 机械工业出版社
2. 《现代操作系统》Anderw S. Tanenbaum，机械工业出版社