# 硬连接与软连接

文件都有文件名与数据，这在 Linux 上被分成两个部分：**用户数据**（user data）与**元数据**（metadata）。

用户数据，即文件数据块 (data block)，数据块是记录文件真实内容的地方；而元数据则是文件的附加属性，如文件大小、创建时间、所有者等信息。在 Linux 中，元数据中的 inode 号（inode 是文件元数据的一部分但其并不包含文件名，inode 号即索引节点号）才是文件的唯一标识而非文件名。文件名仅是为了方便人们的记忆和使用，系统或程序通过 inode 号寻找正确的文件数据块。

下图展示了程序通过文件名获取文件内容的过程：

![img](https://www.ibm.com/developerworks/cn/linux/l-cn-hardandsymb-links/image001.jpg)

硬链接不能对目录创建是受限于文件系统的设计（见 清单 4.对目录创建硬链接将失败）。现 Linux 文件系统中的目录均隐藏了两个个特殊的目录：当前目录（.）与父目录（..）。查看这两个特殊目录的 inode 号可知其实这两目录就是两个硬链接。若系统允许对目录创建硬链接，则会产生目录环。

软链接与硬链接不同，若文件用户数据块中存放的内容是另一文件的路径名的指向，则该文件就是软连接。软链接就是一个普通文件，只是数据块内容有点特殊。软链接有着自己的 inode 号以及用户数据块。因此软链接的创建与使用没有类似硬链接的诸多限制：

- 软链接有自己的文件属性及权限等；
- 可对不存在的文件或目录创建软链接；
- 软链接可交叉文件系统；
- 软链接可对文件或目录创建；
- 创建软链接时，链接计数 `i_nlink` 不会增加；
- 删除软链接并不影响被指向的文件，但若被指向的原文件被删除，则相关软连接被称为死链接（即 dangling link，若被指向路径文件被重新创建，死链接可恢复为正常的软链接）。

![img](https://www.ibm.com/developerworks/cn/linux/l-cn-hardandsymb-links/image002.jpg)

#### 软连接和硬链接的特点：

**软链接**：

- 1 软链接是存放另一个文件的路径的形式存在。
- 2 软链接可以 跨文件系统 ，硬链接不可以。
- 3 软链接可以对一个不存在的文件名进行链接，硬链接必须要有源文件。
- 4 软链接可以对目录进行链接。

**硬链接**：

- 1 硬链接，以文件副本的形式存在。但不占用实际空间。
- 2 不允许给目录创建硬链接。
- 3 硬链接只有在同一个文件系统中才能创建。
- 4 删除其中一个硬链接文件并不影响其他有相同 inode 号的文件。

**不论是硬链接或软链接都不会将原本的档案复制一份，只会占用非常少量的磁碟空间。**

<br>

---

**参考资料**

1. [理解 Linux 的硬链接与软链接](https://www.cnblogs.com/ricklz/p/9378755.html)