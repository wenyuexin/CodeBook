# Docker命名空间

命名空间（ namespace ）是 Linux 内核的一个强大特性，为容器虚拟化的实现带来极大便利。利用这个特性，每个容器都可以拥有自己单独的命名空间，运行在其中的应用都像是在独立的操作系统环境中一样。 命名空间机制保证了容器之间彼此互不影响。
在操作系统中，包括内核、文件系统、网络、进程号（ Process ID, PID ）、用户号（ User ID, UID）、进程间通信（ Inter Process Communication, IPC）等资源，所有的资源都是应用进程直接共享的。 要想实现虚拟化，除了要实现对内存、 CPU 、网络 IO 、硬盘 IO 、存储空间等的限制外，还要实现文件系统、网络、 PID、UID、IPC等的相互隔离。前者相对容易实现一些，后者则需要宿主主机系统的深入支持。

具体包括：

进程命名空间、IPC 命名空间、网络命名空间、挂载命名空间、UTS 命名空间、用户命名空间

<br>

### 进程命名空间

Linux 通过进程命名空间管理进程号，对于同一进程（同一个 task struct ），在不同的命名空间中，看到的进程号不相同。每个进程命名空间有一套自己的进程号管理方法。进程命名空间是一个父子关系的结构，子空间中的进程对于父空间是可见的。新 fork 出的一个进程，在父命名空间和子命名空间将分别对应不同的进程号。

### IPC 命名空间

容器中的进程交互还是采用了 Linux 常见的进程间交互方法（Interprocess Communication, IPC），包括信号 、消息队列和共享内存等方式。PID 命名空间和 IPC 命名空间可以组合起来一起使用，同一个 IPC 命名空间内的进程可以彼此可见，允许进行交互；不同空间的进程则无法交互。

### 网络命名空间

有了进程命名空间后，不同命名空间中的进程号可以相互隔离，但是网络端口还是共享本地系统的端口。

通过网络命名空间，可以实现网络隔离。一个网络命名空间为进程提供了一个完全独立的网络协议校视图。包括网络设备接口 IPv4 和 IPv6 协议械、 IP路由表、 防火墙规则、sockets 等， 这样每个容器的网络就能隔离开来。

### 挂载命名空间

类似于chroot（即change root directory，Linux中用来在指定的根目录下运行指令），**挂载**（Mount, MNT）命名空间可以将一个进程的根文件系统限制到一个特定的目录下。

挂载命名空间允许不同命名空间的进程看到的本地文件位于宿主机中不同路径下，每个命名空间中的进程所看到的文件目录是彼此隔离的。例如，不同命名空间中的进程， 都认为自己独占了一个完整的根文件系统（rootfs），实际上，不同命名空间中的文件彼此隔离，不会造成相互影响 ，同时也无法影响宿主机文件系统中的其他路径。

### UTS 命名空间

UTS (UNIX Time-sharing System）命名空间允许每个容器有独立的主机名和域名，从而可以虚拟出一个有独立主机名和网络空间的环境，就跟网络上一台独立的主机一样。

### 用户命名空间

每个容器可以有不同的用户和组 id，也就是说，可以在容器内使用特定的内部用户执行程序，而非本地系统上存在的用户。
每个容器内部都可以有最高权限的 root 帐号，但跟宿主主机不在一个命名空间。通过使用隔离的用户命名空间，可以提高安全性，避免容器内的进程获取到额外的权限；同时使用不同用户也可以进一步在容器内控制权限。

<br>

---

1. 《Docker技术入门与实战（第三版）》杨保华，机械工业出版社，第17章